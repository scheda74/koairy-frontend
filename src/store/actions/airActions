import { apiUrl, currentAir } from '../../config';
import { RECEIVE_LATEST_AIR, REQUEST_LATEST_AIR } from './actionTypes';

const header = new Headers({
  'Content-Type': 'application/json',
  'Access-Control-Allow-Origin': '*'
});

export function requestAir() {
  return {
    type: REQUEST_LATEST_AIR,
  }
}

export function receiveAir(json) {
  console.log("Emissions received");
  return {
    type: RECEIVE_LATEST_AIR,
    id: json.id,
    location: json.location,
    values: json.values,
    receivedAt: Date.now()
  }
}

export function fetchLatestAir() {
  return async function(dispatch, getState) {
    console.log('are you doing this?');
    dispatch(requestAir());

    return await fetch(apiUrl + currentAir, {headers: header})
      .then(response => response.json(), error => console.log('An error occurred', error))
      .then(json => dispatch(receiveAir(json)))
      .catch(error => console.log('An error occurred', error))
  }
}